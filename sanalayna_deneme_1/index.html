<!DOCTYPE HTML>
<html>
  <head>
    <title>Webcam over WebSocket using OpenCV and Tornado</title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js" integrity="sha512-n8IpKWzDnBOcBhRlHirMZOUvEq2bLRMuJGjuVqbzUJwtTsgwOgK5aS0c1JA647XWYfqvXve8k3PtZdzpipFjgg==" crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        #front-camera{
            width: 640px; 
            height:480px;
        }
        #start-record{
            color: #fff;
            width: 120px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color:#00b365 ;
            border: 2px solid #009152;
            cursor: pointer;
        }
        #start-record:hover{
            background-color: #03fc90;
        }
        #start-record:focus{
            color: #000;
            background-color: #fff;
        }
        #time-left{
            position: fixed;
            top: 15px;
            right: 15px;
        }
    </style>
</head>
  <body>
      <div id="time-left"></div>
      <button id="start-record">Başlat</button>
      <video id="front-camera"></video>
    <script>
            //Gerekli tüm değişkenleri tanımla
            var frontCamera = document.getElementById("front-camera");
            var frameSizes = {
                width:frontCamera.clientWidth,
                height:frontCamera.clientHeight
            };
            var stopRecording = false;
            var object;
            var timeLeftElement = document.getElementById("time-left");
            var startBtn = document.getElementById("start-record");
            var positions = [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];
            var rotations = [[0,0,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0]];
            var scene = new THREE.Scene(); 
            var camera = new THREE.PerspectiveCamera( 25, window.innerWidth / window.innerHeight, 1, 20000 );
            var outputVideo = document.createElement("video");
            outputVideo.width = frameSizes.width;
            outputVideo.height = frameSizes.height;
            var recordedVideo = document.createElement("video");
            recordedVideo.width = frameSizes.width;
            recordedVideo.height = frameSizes.height;
            var mergedCanvas = document.createElement("canvas");
            mergedCanvas.width = frameSizes.width;
            mergedCanvas.height = frameSizes.height;
            var videoStream = mergedCanvas.captureStream(30); // the parameter is the desired framerate, see the MDN doc for more info
            var mediaRecorder = new MediaRecorder(videoStream);
            var chunks = [];

            var videoStream_1 = frontCamera.captureStream(30); // the parameter is the desired framerate, see the MDN doc for more info
            var mediaRecorder_1 = new MediaRecorder(videoStream_1);
            var chunks_1 = [];
            let constraintObj = { 
            audio: false, 
                video: { 
                    facingMode: "user"
                } 
            }; 
            
            //handle older browsers that might implement getUserMedia in some way
            if (navigator.mediaDevices === undefined) {
                navigator.mediaDevices = {};
                navigator.mediaDevices.getUserMedia = function(constraintObj) {
                    let getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                    if (!getUserMedia) {
                        return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
                    }
                    return new Promise(function(resolve, reject) {
                        getUserMedia.call(navigator, constraintObj, resolve, reject);
                    });
                }
            }else{
                navigator.mediaDevices.enumerateDevices()
                .then(devices => {
                    devices.forEach(device=>{
                        console.log(device.kind.toUpperCase(), device.label);
                        //, device.deviceId
                    })
                })
                .catch(err=>{
                    console.log(err.name, err.message);
                })
            }

            navigator.mediaDevices.getUserMedia(constraintObj)
            .then(function(mediaStreamObj) {
                //mediaStream ı ön kameranın gösterileceği video elemmentine bağla
                let cam_view = frontCamera;
                if ("srcObject" in cam_view) {
                    cam_view.srcObject = mediaStreamObj;
                } else {
                    //old version
                    cam_view.src = window.URL.createObjectURL(mediaStreamObj);
                }
                
                cam_view.onloadedmetadata = function(ev) {
                    console.log(mediaStreamObj);
                    //show in the video element what is being captured by the webcam
                    cam_view.play();
            };
         });

            startBtn.addEventListener("click",function(){
                mediaRecorder_1.start();
                countdown(2);
            });

            mediaRecorder_1.ondataavailable = function(e) {
                chunks_1.push(e.data);
            };
            mediaRecorder_1.onstop = function(e) {
                var blob_1 = new Blob(chunks_1, { type : 'video/mp4' }); // other types are available such as 'video/webm' for instance, see the doc for more info
                chunks_1 = [];
                var videoURL_1 = URL.createObjectURL(blob_1);
                recordedVideo.src = videoURL_1;
                socket.send(outgoingMessage);
            };

            mediaRecorder.ondataavailable = function(e) {
                chunks.push(e.data);
            };
            mediaRecorder.onstop = function(e) {
                var blob = new Blob(chunks, { type : 'video/mp4' }); // other types are available such as 'video/webm' for instance, see the doc for more info
                chunks = [];
                var videoURL = URL.createObjectURL(blob);
                outputVideo.src = videoURL;
                outputVideo.controls = true;
                document.body.appendChild(outputVideo);
            };
            camera.position.set( 1, 1, 20 );
            
            // Load a Renderer
            var glassesCanvas = document.createElement("canvas");
            var renderer = new THREE.WebGLRenderer({ alpha: true , canvas:glassesCanvas});
            renderer.setClearColor( 0x000000, 0 ); // the default
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize(frameSizes.width, frameSizes.height);
            
            // Load the Orbitcontroller

                    
            // Load Light
            var ambientLight = new THREE.AmbientLight( 0xcccccc );
            scene.add( ambientLight );
                    
            var directionalLight = new THREE.DirectionalLight( 0xffffff );
            directionalLight.position.set( 0, 1, 1 ).normalize();
            scene.add( directionalLight );				

            // glTf 2.0 Loader
            var loader = new THREE.GLTFLoader();				
            loader.load( './gltfmodel/scene.gltf', function ( gltf ) {         
            object = gltf.scene;				
            object.scale.set( 0.01, 0.01, 0.01 );			   
            object.position.x = 0;				    //Position (x = right+ left-) 
            object.position.y = 0;				    //Position (y = up+, down-)
            object.position.z = 0;			    //Position (z = front +, back-)
            scene.add( object );
            });	 
            
            function renderGlassFrame(positionsArray,rotationsArray){
                        if(rotations[0]==undefined || rotations[0]==null){
                        return 
                        }
                        else{
                            object.rotation.x = THREE.Math.degToRad(rotations[0][0]);
                            object.rotation.y =THREE.Math.degToRad(rotations[0][1]);
                            object.rotation.z = THREE.Math.degToRad(rotations[0][2]);
                            object.position.x = positions[0][0];
                            object.position.y = positions[0][1];
                            object.position.z = positions[0][2];
                            positions.splice(0, 1);
                            rotations.splice(0, 1);
                            renderGlass();
                            //setTimeout(function(){renderPerFrame(positions,rotations);}, 3000);
                        }
            }
            
            function countdown(secondsForWait){
                    this.timer = setInterval(function(){
                        if (secondsForWait == -1) {
                            stopRecording = true;
                            mediaRecorder_1.stop();
                            clearInterval(this.timer);
                            return
                        } else {
                            timeLeftElement.innerHTML="<b>"+secondsForWait+"</b>"+" saniye sonra kayıt duracak...";
                            secondsForWait--;
                        }
                    }, 1000);
                    return;
                }
            function frameExtractor(video,canvas,mergedCanvas,positionsArray,rotationsArray) {
                this.positionsArray = positionsArray;
                this.rotationsArray = rotationsArray;
                // Set up our frame converter
                this.video = video;
                this.viewport = mergedCanvas.getContext("2d");
                this.width = frameSizes.width;
                this.height = frameSizes.height;
                // Create the frame-buffer canvas
                this.framebuffer = document.createElement("canvas");
                this.framebuffer.width = this.width;
                this.framebuffer.height = this.height;
                this.ctx = this.framebuffer.getContext("2d");
                this.ctx1=canvas.getContext("2d");
                var self = this;
                // Start rendering when the video is playing
                this.video.addEventListener("play", function() {
                    mediaRecorder.start();
                    self.render();
                }, false);

                this.video.play();

                // Rendering call-back
                this.render = function() {
                    if (this.video.paused || this.video.ended) {
                        mediaRecorder.stop();
                        return;
                    }
                    this.renderFrame();
                    var self = this;
                    setTimeout(function () {
                        self.render();
                    }, 33);
                };
                // Compute and display the next frame 
                this.renderFrame = function() {
                    // Acquire a video frame from the video element
                    renderGlassFrame(this.positionsArray,this.rotationsArray);
                    this.ctx.drawImage(video,0,0,this.width, this.height);
                    this.ctx.drawImage(canvas,0,0,this.width, this.height);
                    var data = this.ctx.getImageData(0, 0, this.width, this.height);
                    this.viewport.putImageData(data, 0, 0);
                    return;
                };
                function renderGlassFrame(positions,rotations){
                            if(rotations[0]==undefined || rotations[0]==null){
                            return 
                            }
                            else{
                                object.rotation.x = THREE.Math.degToRad(rotations[0][0]);
                                object.rotation.y =THREE.Math.degToRad(rotations[0][1]);
                                object.rotation.z = THREE.Math.degToRad(rotations[0][2]);
                                object.position.x = positions[0][0];
                                object.position.y = positions[0][1];
                                object.position.z = positions[0][2];
                                positions.splice(0, 1);
                                rotations.splice(0, 1);
                                console.log(object.rotation.y);
                                renderGlass();
                                //setTimeout(function(){renderPerFrame(positions,rotations);}, 3000);
                            }
                }
                function renderGlass() {
                        renderer.render( scene, camera );
                }
        }

            
            let socket = new WebSocket("ws://localhost:8089/ws");
            socket.onopen = function(){
                console.log("websocket bağlantısı başarılı.");
            }
            socket.onerror = function(error) {
                alert(`[error] ${error}`);
                console.log(error);
            };

            // message received - show the message in div#messages
            socket.onmessage = function(event) {
            let message = event.data;
            fc = new frameExtractor(recordedVideo,glassesCanvas,mergedCanvas,positions,rotations);
            let messageElem = document.createElement('div');
            messageElem.textContent = message;
            document.getElementById('messages').prepend(messageElem);
            }




    </script>
  </body>
</html>