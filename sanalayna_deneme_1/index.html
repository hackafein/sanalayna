<!DOCTYPE HTML>
<html>
  <head>
    <title>Webcam over WebSocket using OpenCV and Tornado</title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js" integrity="sha512-n8IpKWzDnBOcBhRlHirMZOUvEq2bLRMuJGjuVqbzUJwtTsgwOgK5aS0c1JA647XWYfqvXve8k3PtZdzpipFjgg==" crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        #glasses-canvas{
            width: 920px; 
            height:480px;
        }
        #recorded-video{
            object-fit: cover;
            width: 920px; 
            height:480px;
        }
        #merged-canvas{
            
            width: 920px; 
            height:480px;
        }
        #output-video_client{
            width: 920px; 
            height:480px;
        }
    </style>
</head>
  <body>
      <video id="recorded-video" controls src="sample-video.mp4"></video>
      <video controls id="output-video_client"></video>
    <script>
            var frameSizes = {
                width:920,
                height:480
            };
            var object;
            var positions = [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];
            var rotations = [[0,0,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,3,0],[0,15,0],[0,30,0],[0,45,0],[0,3,0],[0,3,0]];
            var scene = new THREE.Scene(); 
            var camera = new THREE.PerspectiveCamera( 25, window.innerWidth / window.innerHeight, 1, 20000 );
            var outputVideo = document.getElementById("output-video_client");
            var recordedVideo = document.getElementById("recorded-video");
            var mergedCanvas = document.createElement("canvas");
            mergedCanvas.width = frameSizes.width;
            mergedCanvas.height = frameSizes.height;
            var videoStream = mergedCanvas.captureStream(30); // the parameter is the desired framerate, see the MDN doc for more info
            var mediaRecorder = new MediaRecorder(videoStream);
            var chunks = [];
            mediaRecorder.ondataavailable = function(e) {
            chunks.push(e.data);
            };
            mediaRecorder.onstop = function(e) {
            var blob = new Blob(chunks, { type : 'video/mp4' }); // other types are available such as 'video/webm' for instance, see the doc for more info
            chunks = [];
            var videoURL = URL.createObjectURL(blob);
            outputVideo.src = videoURL;
            };
            camera.position.set( 1, 1, 20 );
            
            // Load a Renderer
            var glassesCanvas = document.createElement("canvas");
            var renderer = new THREE.WebGLRenderer({ alpha: true , canvas:glassesCanvas});
            renderer.setClearColor( 0x000000, 0 ); // the default
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize(outputVideo.clientWidth, outputVideo.clientHeight);
            
            // Load the Orbitcontroller

                    
            // Load Light
            var ambientLight = new THREE.AmbientLight( 0xcccccc );
            scene.add( ambientLight );
                    
            var directionalLight = new THREE.DirectionalLight( 0xffffff );
            directionalLight.position.set( 0, 1, 1 ).normalize();
            scene.add( directionalLight );				

            // glTf 2.0 Loader
            var loader = new THREE.GLTFLoader();				
            loader.load( './gltfmodel/scene.gltf', function ( gltf ) {         
            object = gltf.scene;				
            object.scale.set( 0.01, 0.01, 0.01 );			   
            object.position.x = 0;				    //Position (x = right+ left-) 
            object.position.y = 0;				    //Position (y = up+, down-)
            object.position.z = 0;			    //Position (z = front +, back-)
            scene.add( object );
            
            
            fc = new frameExtractor(recordedVideo,glassesCanvas,mergedCanvas,positions,rotations);
            });	 
            console.log(recordedVideo);
            
            function renderGlassFrame(positionsArray,rotationsArray){
                        console.log("çalıştım");
                        if(rotations[0]==undefined || rotations[0]==null){
                        return 
                        }
                        else{
                            object.rotation.x = THREE.Math.degToRad(rotations[0][0]);
                            object.rotation.y =THREE.Math.degToRad(rotations[0][1]);
                            object.rotation.z = THREE.Math.degToRad(rotations[0][2]);
                            object.position.x = positions[0][0];
                            object.position.y = positions[0][1];
                            object.position.z = positions[0][2];
                            positions.splice(0, 1);
                            rotations.splice(0, 1);
                            console.log(object.rotation.y);
                            renderGlass();
                            //setTimeout(function(){renderPerFrame(positions,rotations);}, 3000);
                        }
            }
            
        
        function frameExtractor(video,canvas,mergedCanvas,positionsArray,rotationsArray) {
            this.positionsArray = positionsArray;
            this.rotationsArray = rotationsArray;
            // Set up our frame converter
            this.video = video;
            this.viewport = mergedCanvas.getContext("2d");
            this.width = frameSizes.width;
            this.height = frameSizes.height;
            // Create the frame-buffer canvas
            this.framebuffer = document.createElement("canvas");
            this.framebuffer.width = this.width;
            this.framebuffer.height = this.height;
            this.ctx = this.framebuffer.getContext("2d");
            this.ctx1=canvas.getContext("2d");
            var self = this;
            // Start rendering when the video is playing
            this.video.addEventListener("play", function() {
                mediaRecorder.start();
                
                self.render();
            }, false);
            // Rendering call-back
            this.render = function() {
                if (this.video.paused || this.video.ended) {
                    mediaRecorder.stop();
                    return;
                }
                this.renderFrame();
                var self = this;
                setTimeout(function () {
                    self.render();
                }, 33);
            };
            // Compute and display the next frame 
            this.renderFrame = function() {
                // Acquire a video frame from the video element
                renderGlassFrame(this.positionsArray,this.rotationsArray);
                this.ctx.drawImage(video,0,0,this.width, this.height);
                this.ctx.drawImage(canvas,0,0,this.width, this.height);
                var data = this.ctx.getImageData(0, 0, this.width, this.height);
                this.viewport.putImageData(data, 0, 0);
                return;
            };
            function renderGlassFrame(positions,rotations){
                        console.log("çalıştım");
                        if(rotations[0]==undefined || rotations[0]==null){
                        return 
                        }
                        else{
                            object.rotation.x = THREE.Math.degToRad(rotations[0][0]);
                            object.rotation.y =THREE.Math.degToRad(rotations[0][1]);
                            object.rotation.z = THREE.Math.degToRad(rotations[0][2]);
                            object.position.x = positions[0][0];
                            object.position.y = positions[0][1];
                            object.position.z = positions[0][2];
                            positions.splice(0, 1);
                            rotations.splice(0, 1);
                            console.log(object.rotation.y);
                            renderGlass();
                            //setTimeout(function(){renderPerFrame(positions,rotations);}, 3000);
                        }
            }
            function renderGlass() {
                    renderer.render( scene, camera );
            }
        }






    </script>
  </body>
</html>